<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∞èÂõõ‰∏≠ÊñáË©ûÂΩôÊ®ÇÂúí</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: #1f2937; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden; 
        }
        .app-container {
            background-color: rgba(255, 255, 255, 0.95); 
            border-radius: 24px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 100%;
            max-width: 500px; 
            margin: 20px;
            overflow-y: auto; 
            max-height: 95vh;
        }

        .card-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            min-height: 240px; 
        }
        .card {
            width: 300px;  
            height: 200px; 
            perspective: 1200px;
            cursor: pointer;
            margin-left: auto; 
            margin-right: auto;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            transform-style: preserve-3d;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            border-radius: 16px; 
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 15px; 
            border-radius: 16px;
            font-weight: 700; 
            text-align: center; 
            word-break: normal; 
            overflow-wrap: break-word; 
        }
        .card-front {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); 
            color: white;
            font-size: 1.7rem; 
        }
        .card-back {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%); 
            color: white;
            transform: rotateY(180deg);
            font-size: 0.9rem; 
            overflow-y: auto; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
        }
        .card-back-definition {
            margin-bottom: 10px;
            font-weight: 600;
            text-align: center; 
            width: 100%; 
        }
        .card-back-example {
            font-style: italic;
            font-size: 0.85rem;
            text-align: center; 
            width: 100%; 
        }


        .btn {
            padding: 12px 24px;
            border-radius: 12px; 
            font-weight: 700; 
            cursor: pointer;
            transition: all 0.3s ease; 
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn:hover {
            transform: translateY(-2px) scale(1.03); 
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .btn:active {
            transform: translateY(0px) scale(1); 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #facc15 0%, #eab308 100%); 
            color: #422006; 
        }
        .btn-secondary {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%); 
            color: white;
        }
        .btn-game {
            background: linear-gradient(135deg, #f472b6 0%, #ec4899 100%); 
            color: white;
        }
        .btn-nav { 
            background-color: #cbd5e1; 
            color: #1f2937;
        }
        .btn-nav:hover {
            background-color: #94a3b8;
            color: white;
        }

        .option-btn {
            background-color: #ffffff;
            color: #374151;
            border: 2px solid #e5e7eb; 
            width: 100%;
            text-align: center; /* Center text for vocabulary options */
            margin-bottom: 10px; 
            font-size: 1rem;
            padding: 15px; 
        }
        .option-btn:hover {
            background-color: #f0f9ff; 
            border-color: #60a5fa;
        }
        .option-btn.correct {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            color: white;
            border-color: #059669;
        }
        .option-btn.incorrect {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
            color: white;
            border-color: #dc2626;
        }
        .screen {
            display: none;
            width: 100%;
        }
        .active-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; 
            padding-top: 20px;
            min-height: calc(95vh - 40px); 
        }
        .progress-bar-container {
            width: 90%;
            max-width: 400px;
            height: 25px; 
            background-color: #e5e7eb;
            border-radius: 12px;
            margin: 15px auto;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #60a5fa 0%, #3b82f6 100%);
            border-radius: 12px;
            transition: width 0.4s ease-in-out;
        }
        .mascot-emoji-container { 
            width: 100px;
            height: 100px;
            margin-bottom: 15px;
            animation: bounce 2s infinite ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #FFD700; 
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .mascot-emoji { 
            font-size: 60px; 
            line-height: 1;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .title-text {
            font-size: 2.5rem; 
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            background: -webkit-linear-gradient(#3b82f6, #8b5cf6); 
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .game-card {
            background-color: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
        }
        .quiz-sentence { /* Style for the sentence in quiz mode */
            font-size: 1.25rem;
            line-height: 1.8;
            margin-bottom: 20px;
            text-align: center;
            color: #374151;
        }
        .feedback-message {
            font-size: 1.1rem;
            height: 30px; 
            margin-top: 15px;
            font-weight: 600;
        }
        .icon { 
            font-size: 1.2em;
            display: inline-block; 
        }
        .flashcard-nav-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 400px; 
            margin: 20px auto;
        }
        .home-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px; 
            width: 100%;
        }
        .home-buttons .btn {
            width: 80%;
            max-width: 300px; 
            font-size: 1.25rem; 
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div id="home-screen" class="screen active-screen p-4 text-center">
            <div class="mascot-emoji-container">
                <span class="mascot-emoji">üí°</span>
            </div>
            <h1 class="title-text">Â∞èÂõõ‰∏≠ÊñáË©ûÂΩôÊ®ÇÂúí</h1>
            <div class="home-buttons">
                <button onclick="handleShowScreen('flashcard-screen')" class="btn btn-primary"><span class="icon">üÉè</span>Ê∫´ÁøíË©ûÂΩôÂç°</button>
                <button onclick="handleShowScreen('game-selection-screen')" class="btn btn-game"><span class="icon">üéÆ</span>ÈñãÂßãË©ûÂΩôÈÅäÊà≤</button>
            </div>
            <p class="mt-10 text-sm text-gray-500">ÂíåÂ≠óË©ûÂ∞èÈùàÁ≤æ‰∏ÄËµ∑ËºïÈ¨ÜÂ≠∏‰∏≠ÊñáÔºÅ</p>
        </div>

        <div id="game-selection-screen" class="screen p-4 text-center">
            <h2 class="title-text text-purple-600 mb-8">ÈÅ∏ÊìáÈÅäÊà≤Ê®°Âºè</h2>
            <div class="space-y-5 w-full max-w-sm">
                <button onclick="startGame('meaning-match')" class="btn btn-secondary text-lg w-full"><span class="icon">üß†</span>Ë©ûÁæ©ÈÖçÂ∞çÊ®Ç</button>
                <button onclick="startGame('idiom-match')" class="btn btn-secondary text-lg w-full"><span class="icon">üìñ</span>ÊàêË™ûÊåëÊà∞</button>
                <button onclick="startGame('sentence-fill')" class="btn btn-secondary text-lg w-full"><span class="icon">üìù</span>Âè•Â≠êÂ°´ÂÖÖÊ®Ç</button> 
            </div>
            <button onclick="handleShowScreen('home-screen')" class="btn btn-primary mt-12"><span class="icon">üè†</span>ËøîÂõû‰∏ªÈ†Å</button>
        </div>

        <div id="flashcard-screen" class="screen p-4">
            <h2 class="title-text text-blue-600 mb-2 text-center">Ê∫´ÁøíË©ûÂΩôÂç°</h2>
            <div class="card-container">
                <div class="card" onclick="flipCard()"> 
                    <div class="card-inner">
                        <div id="flashcard-front" class="card-front">
                            Ë©ûË™û
                        </div>
                        <div id="flashcard-back" class="card-back">
                            <div id="flashcard-back-definition" class="card-back-definition">Ëß£Èáã</div>
                            <div id="flashcard-back-example" class="card-back-example">‰æãÂè•</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mb-3 text-gray-600 font-medium">
                <span id="card-counter"></span>
            </div>
            <div class="flashcard-nav-buttons">
                <button onclick="prevCard()" class="btn btn-nav"><span class="icon">‚¨ÖÔ∏è</span>‰∏ä‰∏ÄÂºµ</button>
                <button onclick="shuffleCards()" class="btn btn-nav"><span class="icon">üîÄ</span>Èö®Ê©ü</button>
                <button onclick="nextCard()" class="btn btn-nav">‰∏ã‰∏ÄÂºµ<span class="icon">‚û°Ô∏è</span></button>
            </div>
            <div class="text-center mt-6"> 
                <button onclick="handleShowScreen('home-screen')" class="btn btn-primary"><span class="icon">üè†</span>ËøîÂõû‰∏ªÈ†Å</button>
            </div>
        </div>

        <div id="game-screen" class="screen p-4">
            <h2 id="game-title" class="title-text text-green-600 mb-1 text-center">ÈÅäÊà≤Ê®°Âºè</h2>
            <div class="text-center mb-1 text-lg font-semibold">
                ÂàÜÊï∏Ôºö<span id="score" class="text-yellow-500">0</span>
            </div>
            <div class="progress-bar-container">
                <div id="game-progress-bar" class="progress-bar"></div>
            </div>
            <div class="game-card mx-auto">
                <p class="text-center text-gray-600 mb-2">È°åÁõÆÔºö<span id="question-counter">1</span> / <span id="total-questions">5</span></p> 
                <div id="game-question-area" class="text-center mb-6">
                    <div id="game-word" class="text-3xl font-bold text-indigo-700 break-all" style="display:none;">Ë©ûË™û</div>
                     <div id="quiz-sentence-display" class="quiz-sentence" style="display:none;">Âè•Â≠ê ___ Â°´ÂÖÖ„ÄÇ</div>
                </div>
                <div id="options-container" class="space-y-2">
                </div>
            </div>
            <div id="feedback-message" class="feedback-message text-center"></div>
            <div class="text-center mt-6"> 
                <button onclick="handleShowScreen('game-selection-screen')" class="btn btn-primary"><span class="icon">üîÑ</span>ËøîÂõûÈÅäÊà≤ÈÅ∏Êìá</button>
            </div>
        </div>
    </div>

    <script>
        const synth = new Tone.Synth({
            oscillator: { type: "sine" },
            envelope: { attack: 0.01, decay: 0.1, sustain: 0.3, release: 0.5 }
        }).toDestination();

        const playSound = (note, duration = "16n", timeOffset = 0) => {
            if (typeof Tone !== 'undefined' && Tone.Transport.state !== 'started') {
                Tone.Transport.start();
            }
            synth.triggerAttackRelease(note, duration, Tone.now() + timeOffset);
        };

        const correctSound = () => { playSound("E5", "8n"); playSound("G5", "8n", 0.1); playSound("C6", "8n", 0.2); };
        const incorrectSound = () => playSound("C3", "4n");
        const flipSound = () => playSound("A4", "16n", 0.02);
        // Modified buttonClickSound to add a small offset
        const buttonClickSound = () => playSound("C4", "16n", 0.01); 

        document.body.addEventListener('click', function(event) {
            if (event.target.tagName === 'BUTTON') {
                const cardElement = event.target.closest('.card');
                if (cardElement && cardElement.onclick && cardElement.onclick.toString().includes('flipCard')) {
                    // Handled by flipCard
                } else if (event.target.onclick && event.target.onclick.toString().includes('flipCard')) {
                    // Handled by flipCard
                }
                else {
                    buttonClickSound();
                }
            }
        });

        const vocabulary = [
            // ... (Existing vocabulary with 'example', 'type', and 'quizSentence')
            { term: "Âü∫Á§é", definition: "‰∫ãÁâ©ÁôºÂ±ïÁöÑËµ∑ÂßãÈªûÊàñÈáçË¶ÅÈÉ®ÂàÜ„ÄÇ", example: "Â≠∏Áøí‰ªª‰ΩïÁü•Ë≠òÈÉΩË¶ÅÊâìÂ•ΩÂü∫Á§é„ÄÇ", quizSentence: "Â≠∏ÁøíÊñ∞Áü•Ë≠òÔºåÈ¶ñÂÖàË¶ÅÊâìÂ•Ω ___„ÄÇ", type: "word" },
            { term: "ËÄÉÊÖÆ", definition: "Ë™çÁúüÊÄùËÄÉÔºå‰ª•‰æøÂÅöÂá∫Ê±∫ÂÆöÊàñËôïÁêÜ‰∫ãÊÉÖ„ÄÇ", example: "ÂÅö‰∫ãÂâçË¶Å‰ªîÁ¥∞ËÄÉÊÖÆÂæåÊûú„ÄÇ", quizSentence: "Ë≥ºÁâ©ÂâçÔºåÊàëÂÄëÊáâ ___ ÊòØÂê¶ÁúüÁöÑÈúÄË¶Å„ÄÇ", type: "word" },
            { term: "Ë®≠ÊÉ≥", definition: "ÊÉ≥ÂÉè„ÄÅÊßãÊÉ≥„ÄÇ", example: "ÊàëË®≠ÊÉ≥Â∞á‰æÜËÉΩÊàêÁÇ∫‰∏ÄÂêçÁßëÂ≠∏ÂÆ∂„ÄÇ", quizSentence: "‰Ω†ËÉΩ ___ ‰∏Ä‰∏ãÊú™‰æÜÂüéÂ∏ÇÁöÑÈù¢Ë≤åÂóéÔºü", type: "word" },
            { term: "Â∞àÂà©", definition: "ÁôºÊòé‰∫∫ÊàñË®≠Ë®à‰∫∫Â∞çÂÖ∂ÁôºÊòéÊàñË®≠Ë®à‰æùÊ≥ï‰∫´ÊúâÁöÑÂ∞àÊúâÊ¨äÂà©„ÄÇ", example: "ÈÄôÂÄãÊñ∞ÁôºÊòéÂ∑≤Á∂ìÁî≥Ë´ã‰∫ÜÂ∞àÂà©„ÄÇ", quizSentence: "Áéã‰ºØ‰ºØÁöÑÊñ∞ÁôºÊòéÊàêÂäüÁî≥Ë´ã‰∫Ü ___„ÄÇ", type: "word" },
            { term: "Â†ÖÊØÖ", definition: "ÊÑèÂøóÂ†ÖÂÆöÔºåÊúâÊØÖÂäõÔºå‰∏çËºïÊòìÊîæÊ£Ñ„ÄÇ", example: "‰ªñÊÜëËëóÂ†ÖÊØÖÁöÑÁ≤æÁ•ûÂÖãÊúç‰∫ÜÂõ∞Èõ£„ÄÇ", quizSentence: "ÈÅãÂãïÂì°ÊÜëËëó ___ ÁöÑÁ≤æÁ•ûÂÆåÊàê‰∫ÜÊØîË≥Ω„ÄÇ", type: "word" },
            { term: "Âà©Áõä", definition: "Â•ΩËôï„ÄÇ", example: "ÊàëÂÄë‰∏çÊáâÁÇ∫ÂÄã‰∫∫Âà©ÁõäÊêçÂÆ≥ÈõÜÈ´î„ÄÇ", quizSentence: "ÈÄôÈ†ÖË®àÂäÉËÉΩÁÇ∫Á§æÂçÄÂ∏∂‰æÜÂæàÂ§ö ___„ÄÇ", type: "word" },
            { term: "ÂÇ≥ÈÄÅ", definition: "ÊääÁâ©ÂìÅ„ÄÅÊ∂àÊÅØÁ≠âÂæû‰∏ÄËôïÈÄÅÂà∞Âè¶‰∏ÄËôï„ÄÇ", example: "ÈÉµÂ∑ÆÊØèÂ§©ÂÇ≥ÈÄÅ‰ø°‰ª∂„ÄÇ", quizSentence: "È¥øÂ≠êÂú®Âè§‰ª£Ë¢´Áî®‰æÜ ___ ‰ø°ÊÅØ„ÄÇ", type: "word" },
            { term: "Ë®äÊÅØ", definition: "Ê∂àÊÅØ„ÄÅË≥áË®ä„ÄÇ", example: "ÊàëÊî∂Âà∞‰∫ÜÊúãÂèãÁôº‰æÜÁöÑË®äÊÅØ„ÄÇ", quizSentence: "ÊâãÊ©üÂèØ‰ª•Âø´ÈÄüÊé•Êî∂ÂêÑÁ®Æ ___„ÄÇ", type: "word" },
            { term: "ÊáâÁî®", definition: "‰ΩøÁî®ÔºàÁêÜË´ñ„ÄÅÁü•Ë≠ò„ÄÅÊñπÊ≥ïÁ≠âÔºâ„ÄÇ", example: "ÊàëÂÄëË¶ÅÂ≠∏ÊúÉÊääÁü•Ë≠òÊáâÁî®Âà∞ÁîüÊ¥ª‰∏≠„ÄÇ", quizSentence: "ÈõªËÖ¶Âú®ÂêÑË°åÂêÑÊ•≠ÈÉΩÊúâÂª£Ê≥õÁöÑ ___„ÄÇ", type: "word" },
            { term: "Ê∏ÖÊæà", definition: "ÂΩ¢ÂÆπÊ∞¥ÈùûÂ∏∏‰πæÊ∑®ÈÄèÊòé„ÄÇ", example: "Â∞èÊ≤≥ÁöÑÊ∞¥Ê∏ÖÊæàË¶ãÂ∫ï„ÄÇ", quizSentence: "ÊπñÊ∞¥ ___ÔºåÂèØ‰ª•ÁúãÂà∞Ê∞¥Â∫ïÁöÑÁü≥È†≠„ÄÇ", type: "word" },
            { term: "ÁßëÊäÄ", definition: "ÁßëÂ≠∏ÊäÄË°ì„ÄÇ", example: "Áèæ‰ª£ÁßëÊäÄÁôºÂ±ïËøÖÈÄü„ÄÇ", quizSentence: "___ ÁöÑÈÄ≤Ê≠•ÊîπÂñÑ‰∫ÜÊàëÂÄëÁöÑÁîüÊ¥ª„ÄÇ", type: "word" },
            { term: "ÂºïË™ò", definition: "Áî®ÊüêÁ®ÆÊâãÊÆµÊàñÊñπÊ≥ï‰æÜÂê∏ÂºïÊàñË™ò‰ΩøÂà•‰∫∫„ÄÇ", example: "‰∏çË¶ÅË¢´Â£û‰∫∫ÁöÑËä±Ë®ÄÂ∑ßË™ûÊâÄÂºïË™ò„ÄÇ", quizSentence: "ÁãêÁã∏Áî®ÁæéÈ£ü ___ Â∞èÁôΩÂÖî„ÄÇ", type: "word" },
            { term: "ÂèçË¶Ü", definition: "‰∏ÄÊ¨°Âèà‰∏ÄÊ¨°ÔºõÈáçË§á„ÄÇ", example: "‰ªñÂèçË¶ÜÁ∑¥ÁøíÈÄôÂÄãÂãï‰Ωú„ÄÇ", quizSentence: "ËÄÅÂ∏´ ___ Âº∑Ë™øË¶ÅÊ≥®ÊÑèÂÆâÂÖ®„ÄÇ", type: "word" },
            { term: "ËáâËÖ´È°çÈùí", definition: "ÂΩ¢ÂÆπËáâÈÉ®ÂèóÂÇ∑ÔºåÂèàÁ¥ÖÂèàËÖ´ÂèàÁôºÈùíÁöÑÊ®£Â≠ê„ÄÇ", example: "‰ªñ‰∏çÂ∞èÂøÉÊëîÂÄíÔºåË∑åÂæóËáâËÖ´È°çÈùí„ÄÇ", quizSentence: "ÊâìÊû∂ÂæåÔºå‰ªñË¢´ÊâìÂæó ___„ÄÇ", type: "word" },
            { term: "ÂëÜÊùø", definition: "‰∏çÈùàÊ¥ªÔºåÁº∫‰πèÁîüÊ∞£„ÄÇ", example: "ÈÄôÁØáÊñáÁ´†ÁöÑË™ûË®ÄÊúâ‰∫õÂëÜÊùø„ÄÇ", quizSentence: "‰ªñÁöÑË°®ÊÉÖÁ∏ΩÊòØÈÇ£È∫º ___ÔºåÂæàÂ∞ëÁ¨ë„ÄÇ", type: "word" },
            { term: "ÂêÉËôß", definition: "ÂèóÂà∞ÊêçÂ§±Êàñ‰∏çÂÖ¨Âπ≥ÁöÑÂæÖÈÅá„ÄÇ", example: "‰ªñÂõ†ÁÇ∫Ë≤™Â∞è‰æøÂÆúËÄåÂêÉ‰∫ÜÂ§ßËôß„ÄÇ", quizSentence: "Ë™†ÂØ¶ÁöÑ‰∫∫Á∏ΩÊòØ‰∏çÊúÉ ___„ÄÇ", type: "word" },
            { term: "ÊùêÊñô", definition: "Ë£Ω‰ΩúÊàêÂìÅÊâÄÈúÄË¶ÅÁöÑÊù±Ë•ø„ÄÇ", example: "ÂÅöËõãÁ≥ïÈúÄË¶ÅÊ∫ñÂÇôÂæàÂ§öÊùêÊñô„ÄÇ", quizSentence: "Âª∫ÁØâÂ∑•‰∫∫ÈúÄË¶ÅË∂≥Â§†ÁöÑÂª∫ÁØâ ___„ÄÇ", type: "word" },
            { term: "Êëî", definition: "Ë∑åÂÄí„ÄÇ", example: "Ëµ∞Ë∑ØË¶ÅÂ∞èÂøÉÔºå‰∏çË¶ÅÊëîÂÄí„ÄÇ", quizSentence: "‰ªñ‰∏çÂ∞èÂøÉ ___ ‰∫Ü‰∏ÄË∑§„ÄÇ", type: "word" },
            { term: "Êå´Êäò", definition: "Âú®ÈÅéÁ®ã‰∏≠ÈÅáÂà∞ÁöÑÂõ∞Èõ£ÂíåÂ§±Êïó„ÄÇ", example: "ÈÅáÂà∞Êå´Êäò‰∏çË¶ÅËºïÊòìÊîæÊ£Ñ„ÄÇ", quizSentence: "‰∫∫ÁîüÈõ£ÂÖçÊúÉÈÅáÂà∞ ___ ÂíåÂõ∞Èõ£„ÄÇ", type: "word" },
            { term: "ÊîæÊ£Ñ", definition: "‰∏çÂÜçÂ†ÖÊåÅÊàñËøΩÊ±Ç„ÄÇ", example: "‰ªñÊ±∫ÂÆöÊîæÊ£ÑÈÄôÂÄã‰∏çÂàáÂØ¶ÈöõÁöÑË®àÂäÉ„ÄÇ", quizSentence: "ÈõñÁÑ∂ÂæàÈõ£Ôºå‰ΩÜ‰ªñÂæûÊú™ÊÉ≥ÈÅé ___„ÄÇ", type: "word" },
            { term: "Âö¥Ê†º", definition: "ÈÅµÂÆàË¶èÂÆöÊàñÊ®ôÊ∫ñÔºå‰∏çÊîæÈ¨Ü„ÄÇ", example: "ËÄÅÂ∏´Â∞çÊàëÂÄëÁöÑË¶ÅÊ±ÇÂæàÂö¥Ê†º„ÄÇ", quizSentence: "ÊïôÁ∑¥Â∞çÈÅãÂãïÂì°ÁöÑË®ìÁ∑¥ÈùûÂ∏∏ ___„ÄÇ", type: "word" },
            { term: "Êé°Âèñ", definition: "Êé°Á¥çÂíåÂØ¶Ë°åÔºàÊñπÊ≥ï„ÄÅÊîøÁ≠ñÁ≠âÔºâ„ÄÇ", example: "ÊîøÂ∫úÊé°Âèñ‰∫ÜÊñ∞ÁöÑÊé™ÊñΩ‰æÜÊîπÂñÑ‰∫§ÈÄö„ÄÇ", quizSentence: "Èù¢Â∞çÂïèÈ°åÔºåÊàëÂÄëË¶Å ___ ÊúâÊïàÁöÑËß£Ê±∫ÊñπÊ≥ï„ÄÇ", type: "word" },
            { term: "Âé≤ÂÆ≥", definition: "Ë°®Á§∫Á®ãÂ∫¶Ê∑±ÊàñËÉΩÂäõÂº∑„ÄÇ", example: "ÈÄôÂÄãÈ¢±È¢®ÁúüÂé≤ÂÆ≥ÔºÅ", quizSentence: "‰ªñÁöÑË®òÊÜ∂ÂäõÈùûÂ∏∏ ___ÔºåÈÅéÁõÆ‰∏çÂøò„ÄÇ", type: "word" },
            { term: "ÊàêÂêç", definition: "ËÆäÂæóÊúâÂêçÊ∞£„ÄÇ", example: "‰ªñÂ§¢ÊÉ≥Êúâ‰∏ÄÂ§©ËÉΩÊàêÁÇ∫ÊàêÂêçÁï´ÂÆ∂„ÄÇ", quizSentence: "ÈÄô‰ΩçÊ≠åÊâãÂõ†‰∏ÄÈ¶ñÊ≠åËÄåËøÖÈÄü ___„ÄÇ", type: "word" },
            { term: "Ëâ±Ëæõ", definition: "Âõ∞Èõ£ËæõËã¶„ÄÇ", example: "ÊàêÂäüÁöÑËÉåÂæåÂæÄÂæÄ‰ªòÂá∫ÂæàÂ§öËâ±Ëæõ„ÄÇ", quizSentence: "‰ªñÂÄëÁ∂ìÊ≠∑‰∫ÜÁÑ°Êï∏ ___ ÊâçÂèñÂæóÊàêÂäü„ÄÇ", type: "word" },
            { term: "Âö¥Âé≤", definition: "ÊÖãÂ∫¶Âö¥ËÇÖÔºå‰∏çÂØ¨ÂÆπ„ÄÇ", example: "Áà∏Áà∏Áî®Âö¥Âé≤ÁöÑË™ûÊ∞£ÊâπË©ï‰∫Ü‰ªñ„ÄÇ", quizSentence: "Ê†°Èï∑Áî® ___ ÁöÑÁõÆÂÖâÁúãËëóÁäØÈåØÁöÑÂ≠∏Áîü„ÄÇ", type: "word" },
            { term: "ËæúË≤†", definition: "Â∞ç‰∏çËµ∑Âà•‰∫∫ÁöÑÊúüÊúõÊàñÂ•ΩÊÑè„ÄÇ", example: "ÊàëÂÄë‰∏çËÉΩËæúË≤†ËÄÅÂ∏´ÁöÑÊúüÊúõ„ÄÇ", quizSentence: "Êàë‰∏ÄÂÆöÂä™ÂäõÂ≠∏ÁøíÔºå‰∏ç ___ Áà∂ÊØçÁöÑÊúüÊúõ„ÄÇ", type: "word" },
            { term: "Êµ∏Ê∑´", definition: "ÊØîÂñªÈï∑ÊôÇÈñìËôïÊñºÊüêÁ®ÆÁí∞Â¢ÉÊàñÊÄùÊÉ≥ÂΩ±Èüø‰πã‰∏ã„ÄÇ", example: "‰ªñÂæûÂ∞èÊµ∏Ê∑´Âú®Èü≥Ê®Ç‰∏≠„ÄÇ", quizSentence: "ÈÄô‰ΩçÂ≠∏ËÄÖÂú®Âè§ÂÖ∏ÊñáÂ≠∏ÊñπÈù¢ ___ Â§öÂπ¥„ÄÇ", type: "word" },
            { term: "Á®±ËÆö", definition: "Áî®Ë®ÄË™ûË°®ÈÅîÂ∞ç‰∫∫Êàñ‰∫ãÁâ©ÁöÑÂñúÊÑõ„ÄÅÊï¨‰Ω©„ÄÇ", example: "ËÄÅÂ∏´Á®±ËÆöÂ∞èÊòéÊ®ÇÊñºÂä©‰∫∫„ÄÇ", quizSentence: "Â§ßÂÆ∂ÈÉΩ ___ ‰ªñÂãáÊï¢ÁöÑË°åÁÇ∫„ÄÇ", type: "word" },
            { term: "Á¨®Êãô", definition: "Âãï‰Ωú‰∏çÈùàÊ¥ª„ÄÅ‰∏çÂ∑ßÂ¶ô„ÄÇ", example: "Â∞èÈ¥®Â≠êËµ∞Ë∑ØÁöÑÊ®£Â≠êÂæàÁ¨®Êãô„ÄÇ", quizSentence: "‰ªñÂâõÂ≠∏Ë∑≥ËàûÔºåÂãï‰ΩúÈÇÑÊúâ‰∫õ ___„ÄÇ", type: "word" },
            { term: "ËºïÊí´", definition: "Áî®ÊâãËºïËºïÂú∞Êë∏„ÄÇ", example: "Â™ΩÂ™ΩËºïÊí´ËëóÂ≠©Â≠êÁöÑÈ†≠È´Æ„ÄÇ", quizSentence: "ÂæÆÈ¢® ___ ËëóÊπñÈù¢ÔºåÊ≥õËµ∑Èô£Èô£Êº£Êº™„ÄÇ", type: "word" },
            { term: "ÂÑ™ÂÖà", definition: "ÊääÈáçË¶ÅÁöÑ‰∫ãÊÉÖÂÖàÂÅö„ÄÇ", example: "ÈÅáÂà∞Á∑äÊÄ•ÊÉÖÊ≥ÅÔºåË¶ÅÂÑ™ÂÖàËôïÁêÜ„ÄÇ", quizSentence: "Âú®Ë≥áÊ∫êÊúâÈôêÁöÑÊÉÖÊ≥Å‰∏ãÔºåÊàëÂÄëË¶Å ___ ËÄÉÊÖÆÊúÄËø´ÂàáÁöÑÈúÄÊ±Ç„ÄÇ", type: "word" },
            { term: "Ê≥®Ë¶ñ", definition: "ÈõÜ‰∏≠ÁõÆÂÖâÁúã„ÄÇ", example: "‰ªñÂ∞àÂøÉÊ≥®Ë¶ñËëóÈªëÊùø„ÄÇ", quizSentence: "Â∞èË≤ìÂ•ΩÂ•áÂú∞ ___ ËëóÈ£õËàûÁöÑËù¥Ëù∂„ÄÇ", type: "word" },
            { term: "‰∏üÊ£Ñ", definition: "ÊâîÊéâ‰∏çË¶ÅÁöÑÊù±Ë•ø„ÄÇ", example: "‰∏çË¶ÅÈö®Âú∞‰∏üÊ£ÑÂûÉÂúæ„ÄÇ", quizSentence: "ÊàëÂÄëÊáâË©≤ÊääÂª¢ËàäÈõªÊ±†ÂõûÊî∂ÔºåËÄå‰∏çÊòØÈö®ÊÑè ___„ÄÇ", type: "word" },
            { term: "Ë®™Âïè", definition: "ÁÇ∫‰∫Ü‰∫ÜËß£ÊÉÖÊ≥ÅËÄåÈÄ≤Ë°åÁöÑÁúãÊúõÂíåË´áË©±„ÄÇ", example: "Ë®òËÄÖË®™Âïè‰∫ÜÈÇ£‰ΩçË¶ãÁæ©ÂãáÁÇ∫ÁöÑËã±ÈõÑ„ÄÇ", quizSentence: "Ê†°Èï∑Ë¶™Ëá™ ___ ‰∫ÜÁîüÁóÖÁöÑÂêåÂ≠∏„ÄÇ", type: "word" },
            { term: "Ë™§Ëß£", definition: "ÁêÜËß£Âæó‰∏çÊ≠£Á¢∫„ÄÇ", example: "‰ªñÂÄë‰πãÈñìÁî¢Áîü‰∫Ü‰∏Ä‰∫õÂ∞èË™§Ëß£„ÄÇ", quizSentence: "ÈÄôÂèØËÉΩÂè™ÊòØ‰∏ÄÂ†¥ ___ÔºåÊàëÂÄëÊáâË©≤Â•ΩÂ•ΩÊ∫ùÈÄö„ÄÇ", type: "word" },
            { term: "ËÅäÂ§©", definition: "ËºïÈ¨ÜÂú∞Ë´áË©±„ÄÇ", example: "ÊàëÂÄëÂ∏∏Â∏∏Âú®ÂÖ¨ÂúíË£°ËÅäÂ§©„ÄÇ", quizSentence: "ÊîæÂ≠∏ÂæåÔºåÂêåÂ≠∏ÂÄëÂñúÊ≠°ËÅöÂú®‰∏ÄËµ∑ ___„ÄÇ", type: "word" },
            { term: "‰∏ÄË¶ãÈçæÊÉÖ", definition: "Áî∑Â•≥‰πãÈñìÁ¨¨‰∏ÄÊ¨°Ë¶ãÈù¢Â∞±Áî¢Áîü‰∫ÜÊÑõÊÉÖ„ÄÇ", example: "ÁéãÂ≠êÂ∞çÁÅ∞ÂßëÂ®ò‰∏ÄË¶ãÈçæÊÉÖ„ÄÇ", quizSentence: "ÊïÖ‰∫ãË£°ÁöÑÁî∑Â•≥‰∏ªËßíÂú®ËàûÊúÉ‰∏ä ___„ÄÇ", type: "idiom" },
            { term: "Ë®Ä‰πãÈëøÈëø", definition: "ÂΩ¢ÂÆπË™™Ë©±ÊúâÁ¢∫ÂØ¶ÁöÑÊ†πÊìöÔºåÈùûÂ∏∏ËÇØÂÆö„ÄÇ", example: "‰ªñË®Ä‰πãÈëøÈëøÂú∞Ë™™Ëá™Â∑±ÁúãË¶ã‰∫ÜUFO„ÄÇ", quizSentence: "‰ªñ ___ Âú∞‰øùË≠âÈÄô‰ª∂‰∫ãÊòØÁúüÁöÑ„ÄÇ", type: "idiom" },
            { term: "‰øÉËÜùË´áÂøÉ", definition: "ÂΩ¢ÂÆπÈõôÊñπÈù†ËøëÂùêËëóÔºåË¶™ÂØÜÂú∞‰∫§Ë´áÂøÉË£°Ë©±„ÄÇ", example: "‰ªñÂÄëÂÄÜÁ∂ìÂ∏∏‰øÉËÜùË´áÂøÉÔºåÁÑ°ÊâÄ‰∏çË´á„ÄÇ", quizSentence: "Áà∫Áà∫ÂñúÊ≠°ÂíåÊàëÂÄë ___ÔºåË¨õÈÅéÂéªÁöÑÊïÖ‰∫ã„ÄÇ", type: "idiom" },
            { term: "ÁÇ∫Èùû‰ΩúÊ≠π", definition: "ÂÅöÂêÑÁ®ÆÂ£û‰∫ã„ÄÇ", example: "ÈÇ£‰∫õÁÇ∫Èùû‰ΩúÊ≠πÁöÑÂ£û‰∫∫ÊúÄÁµÇÊúÉÂèóÂà∞Êá≤ÁΩ∞„ÄÇ", quizSentence: "Ë≠¶ÂØüÊàêÂäüÊäìÁç≤‰∫Ü‰∏ÄÁæ§ ___ ÁöÑÂå™Âæí„ÄÇ", type: "idiom" },
            { term: "ÂÆ≥Áæ£‰πãÈ¶¨", definition: "ÊØîÂñªÂç±ÂÆ≥ÈõÜÈ´îÁöÑ‰∫∫„ÄÇ", example: "ÊàëÂÄëË¶ÅÊääÈöä‰ºç‰∏≠ÁöÑÂÆ≥Áæ£‰πãÈ¶¨Êè™Âá∫‰æÜ„ÄÇ", quizSentence: "ÊØèÂÄãÂúòÈöäÈÉΩÊáâË©≤Ë≠¶ÊÉï ___ ÁöÑÂá∫Áèæ„ÄÇ", type: "idiom" },
            { term: "Êå∫Ë∫´ËÄåÂá∫", definition: "ÂΩ¢ÂÆπÂãáÊï¢Á´ôÂá∫‰æÜÔºåÊâøÊìîË≤¨‰ªªÊàñËß£Ê±∫Âõ∞Èõ£„ÄÇ", example: "Âú®Âç±ÊÄ•ÈóúÈ†≠ÔºåÊ∂àÈò≤Âì°Á∏ΩÊòØÊå∫Ë∫´ËÄåÂá∫„ÄÇ", quizSentence: "Áï∂Â∞èÁãóÊéâÈÄ≤Ê∞¥Ë£°Ôºå‰ªñÊØ´‰∏çÁå∂Ë±´Âú∞ ___ Êïë‰∫ÜÂÆÉ„ÄÇ", type: "idiom" },
            { term: "ÊÅØÊÅØÁõ∏Èóú", definition: "ÂΩ¢ÂÆπÈóú‰øÇÈùûÂ∏∏ÂØÜÂàá„ÄÇ", example: "Áí∞Â¢É‰øùË≠∑ËàáÊàëÂÄëÁöÑÁîüÊ¥ªÊÅØÊÅØÁõ∏Èóú„ÄÇ", quizSentence: "ÊàëÂÄëÁöÑÂÅ•Â∫∑ËàáÈ£≤È£üÁøíÊÖ£ ___„ÄÇ", type: "idiom" },
            { term: "ÂüãÈ†≠Ëã¶Âππ", definition: "ÂΩ¢ÂÆπÂ∞àÂøÉ‰∏ÄÊÑèÂú∞ÂàªËã¶Â∑•‰Ωú„ÄÇ", example: "ÁßëÂ≠∏ÂÆ∂ÂÄëÊ≠£ÂüãÈ†≠Ëã¶ÂππÔºåÈÄ≤Ë°åÈáçË¶ÅÁöÑÁ†îÁ©∂„ÄÇ", quizSentence: "ÁÇ∫‰∫ÜÂÆåÊàê‰ªªÂãôÔºå‰ªñ ___‰∫ÜÂ•ΩÂπæÂ§©„ÄÇ", type: "idiom" },
            { term: "ÈñâÈñÄÈÄ†Ëªä", definition: "ÊØîÂñªËÑ´Èõ¢ÂØ¶ÈöõÔºåÂè™ÊÜë‰∏ªËßÄËæ¶‰∫ãÔºå‰∏çËàá‰∫∫‰∫§ÊµÅ„ÄÇ", example: "Â≠∏ÁøíÊñ∞Áü•Ë≠ò‰∏çËÉΩÈñâÈñÄÈÄ†ËªäÔºåË¶ÅÂ§öÂíåÂà•‰∫∫Ë®éË´ñ„ÄÇ", quizSentence: "Ë®≠Ë®àÁî¢ÂìÅ‰∏çËÉΩ ___ÔºåË¶Å‰∫ÜËß£Â∏ÇÂ†¥ÈúÄÊ±Ç„ÄÇ", type: "idiom" },
            { term: "ÂèÉÂ∑Æ‰∏çÈΩä", definition: "ÂΩ¢ÂÆπÈï∑Áü≠„ÄÅÈ´ò‰Ωé„ÄÅÂ•ΩÂ£ûÁ≠â‰∏ç‰∏ÄËá¥Ôºå‰∏çÊï¥ÈΩä„ÄÇ", example: "ÈÄô‰∫õÊ®πÊú®Èï∑ÂæóÂèÉÂ∑Æ‰∏çÈΩä„ÄÇ", quizSentence: "ÂêåÂ≠∏ÂÄëÁöÑÊõ∏Ê≥ï‰ΩúÂìÅÊ∞¥Âπ≥ ___„ÄÇ", type: "idiom" },
            { term: "Èõ™‰∏≠ÈÄÅÁÇ≠", definition: "ÊØîÂñªÂú®Âà•‰∫∫ÊÄ•ÈúÄÁöÑÊôÇÂÄôÁµ¶‰∫àÂπ´Âä©„ÄÇ", example: "Âú®‰ªñÊúÄÂõ∞Èõ£ÁöÑÊôÇÂÄôÔºåÊúãÂèãÁöÑÂπ´Âä©ÁúüÊòØÈõ™‰∏≠ÈÄÅÁÇ≠„ÄÇ", quizSentence: "Â∞çÊñºÁÅΩÂçÄ‰∫∫Ê∞ë‰æÜË™™ÔºåÊØè‰∏Ä‰ªΩÊçêÂä©ÈÉΩÊòØ ___„ÄÇ", type: "idiom" },
            { term: "ÊúõÊ¢ÖÊ≠¢Ê∏¥", definition: "ÊØîÂñªÁî®Á©∫ÊÉ≥‰æÜÂÆâÊÖ∞Ëá™Â∑±„ÄÇ", example: "Ê≤íÊúâÊ∞¥ÂñùÔºåÂ£´ÂÖµÂÄëÂè™ËÉΩÈù†ÊúõÊ¢ÖÊ≠¢Ê∏¥‰æÜÂ†ÖÊåÅ„ÄÇ", quizSentence: "ÁúãËëóÁæéÈ£üÂúñÁâáÂçªÂêÉ‰∏çÂà∞ÔºåÁúüÊòØ ___ ÂïäÔºÅ", type: "idiom" }
        ];


        let currentCardIndex = 0;
        let shuffledVocab = [...vocabulary];

        function handleShowScreen(screenId) {
            console.log(`Ê∫ñÂÇôÂ∞éËà™Ëá≥ (Preparing to navigate to): ${screenId}`);
            showScreen(screenId);
        }

        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            let foundScreen = false;
            screens.forEach(screen => {
                if (screen.id === screenId) {
                    screen.classList.add('active-screen');
                    foundScreen = true;
                } else {
                    screen.classList.remove('active-screen');
                }
            });

            if (!foundScreen) {
                console.error(`ÈåØË™§ÔºöÊâæ‰∏çÂà∞IDÁÇ∫ "${screenId}" ÁöÑÁï´Èù¢„ÄÇ (Error: Screen with ID "${screenId}" not found.)`);
                if (screenId !== 'home-screen') { 
                    const homeScreenElement = document.getElementById('home-screen');
                    if (homeScreenElement) {
                         console.log("ÂòóË©¶ËøîÂõû‰∏ªÈ†Å (Attempting to fallback to home screen).");
                         homeScreenElement.classList.add('active-screen');
                    } else {
                        console.error("Ëá¥ÂëΩÈåØË™§Ôºö‰∏ªÈ†ÅÁï´Èù¢ (home-screen) ‰πüÊâæ‰∏çÂà∞ÔºÅ(Fatal Error: Home screen also not found!)");
                    }
                }
                return;
            }
            
            console.log(`ÊàêÂäüÈ°ØÁ§∫Áï´Èù¢ (Successfully displayed screen): ${screenId}`);

            if (screenId === 'flashcard-screen') {
                loadFlashcard();
            }
        }

        function loadFlashcard() {
            if (shuffledVocab.length === 0) {
                console.warn("Ë©ûÂΩôÂ∫´ÁÇ∫Á©∫ÔºåÁÑ°Ê≥ïËºâÂÖ•Ë©ûÂΩôÂç°„ÄÇ(Vocabulary is empty, cannot load flashcard.)");
                return;
            }
            const card = shuffledVocab[currentCardIndex];
            document.getElementById('flashcard-front').textContent = card.term; 
            document.getElementById('flashcard-back-definition').textContent = card.definition;
            document.getElementById('flashcard-back-example').textContent = `‰æãÔºö${card.example || 'Êö´ÁÑ°‰æãÂè•'}`; 
            
            const cardElement = document.querySelector('#flashcard-screen .card');
            if (cardElement) {
                cardElement.classList.remove('flipped');
            }
            document.getElementById('card-counter').textContent = `Á¨¨ ${currentCardIndex + 1} / ${shuffledVocab.length} Âºµ`;
        }

        function flipCard() {
            const cardElement = document.querySelector('#flashcard-screen .card');
            if (cardElement) {
                cardElement.classList.toggle('flipped');
                flipSound();
            }
        }

        function nextCard() {
            if (shuffledVocab.length === 0) return;
            currentCardIndex = (currentCardIndex + 1) % shuffledVocab.length;
            loadFlashcard();
        }

        function prevCard() {
            if (shuffledVocab.length === 0) return;
            currentCardIndex = (currentCardIndex - 1 + shuffledVocab.length) % shuffledVocab.length;
            loadFlashcard();
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function shuffleCards() {
            shuffleArray(shuffledVocab);
            currentCardIndex = 0;
            loadFlashcard();
        }

        let currentGameType = 'word'; 
        let gameQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        const NUM_QUIZ_QUESTIONS = 5; 
        const NUM_MEANING_MATCH_QUESTIONS = 10;
        const NUM_OPTIONS = 3;

        function startGame(type) {
            currentGameType = type;
            let title = '';
            let questionSource = [];
            let numTotalQuestions = 0;

            const gameWordEl = document.getElementById('game-word');
            const quizSentenceEl = document.getElementById('quiz-sentence-display');
            gameWordEl.style.display = 'none'; 
            quizSentenceEl.style.display = 'none'; 


            if (type === 'meaning-match') {
                title = 'Ë©ûÁæ©ÈÖçÂ∞çÊ®Ç';
                questionSource = vocabulary.filter(v => v.type === 'word');
                numTotalQuestions = NUM_MEANING_MATCH_QUESTIONS;
                gameWordEl.style.display = 'block';
            } else if (type === 'idiom-match') {
                title = 'ÊàêË™ûÊåëÊà∞';
                questionSource = vocabulary.filter(v => v.type === 'idiom');
                numTotalQuestions = NUM_MEANING_MATCH_QUESTIONS;
                 gameWordEl.style.display = 'block';
            } else if (type === 'sentence-fill') {
                title = 'Âè•Â≠êÂ°´ÂÖÖÊ®Ç';
                questionSource = vocabulary.filter(v => v.quizSentence && v.quizSentence.includes("___"));
                numTotalQuestions = NUM_QUIZ_QUESTIONS;
                quizSentenceEl.style.display = 'block';
            }
            document.getElementById('game-title').textContent = title;
            
            const uniqueTerms = new Set(questionSource.map(item => item.term));
            if (uniqueTerms.size < NUM_OPTIONS && questionSource.length >= NUM_OPTIONS) {
                 console.warn("Ë©ûÂΩôÈÅ∏È†ÖÈáçË§áËºÉÂ§öÔºåÈÅ∏È†ÖÂèØËÉΩ‰∏çÂ§†Áç®Áâπ„ÄÇ");
            } else if (questionSource.length < NUM_OPTIONS && type !== 'sentence-fill') { 
                 alert(`Êä±Ê≠âÔºå${currentGameType === 'word' ? 'Ë©ûË™û' : 'ÊàêË™û'}Êï∏Èáè‰∏çË∂≥‰ª•ÈñãÂßãÈÅäÊà≤ (ÊúÄÂ∞ëÈúÄË¶Å${NUM_OPTIONS}ÂÄã‰∏çÂêåÁöÑË©ûÂΩô)„ÄÇ`);
                handleShowScreen('game-selection-screen');
                return;
            } else if (questionSource.length === 0 && type === 'sentence-fill') {
                alert(`Êä±Ê≠âÔºåÊ≤íÊúâË∂≥Â§†ÁöÑÂè•Â≠êÂ°´ÂÖÖÈ°åÁõÆ„ÄÇ`);
                handleShowScreen('game-selection-screen');
                return;
            }


            shuffleArray(questionSource);
            gameQuestions = questionSource.slice(0, Math.min(numTotalQuestions, questionSource.length));
             if (gameQuestions.length === 0 && questionSource.length > 0) { 
                gameQuestions = [questionSource[0]];
            }
            
            currentQuestionIndex = 0;
            score = 0;
            document.getElementById('score').textContent = score;

            const totalQuestionsElement = document.getElementById('total-questions');
            totalQuestionsElement.textContent = gameQuestions.length || (type === 'sentence-fill' ? NUM_QUIZ_QUESTIONS : NUM_MEANING_MATCH_QUESTIONS);
            
            updateGameProgressBar();
            loadGameQuestion();
            handleShowScreen('game-screen');
        }
        
        function updateGameProgressBar() {
            const totalQ = gameQuestions.length || (currentGameType === 'sentence-fill' ? NUM_QUIZ_QUESTIONS : NUM_MEANING_MATCH_QUESTIONS);
            const progress = totalQ > 0 ? ((currentQuestionIndex) / totalQ) * 100 : 0;
            const progressBarElement = document.getElementById('game-progress-bar');
            if(progressBarElement) progressBarElement.style.width = `${progress}%`;
        }

        function loadGameQuestion() {
            if (currentQuestionIndex >= gameQuestions.length) {
                endGame();
                return;
            }
            updateGameProgressBar();
            document.getElementById('question-counter').textContent = currentQuestionIndex + 1;
            const question = gameQuestions[currentQuestionIndex];
            
            const gameWordEl = document.getElementById('game-word');
            const quizSentenceEl = document.getElementById('quiz-sentence-display');

            let correctAnswer;
            let options = [];
            let distractorsPool = [];

            if (currentGameType === 'sentence-fill') {
                gameWordEl.style.display = 'none';
                quizSentenceEl.style.display = 'block';
                quizSentenceEl.textContent = question.quizSentence;
                correctAnswer = question.term; 
                options.push(correctAnswer);
                distractorsPool = vocabulary.filter(v => v.term !== correctAnswer); 
            } else { 
                gameWordEl.style.display = 'block';
                quizSentenceEl.style.display = 'none';
                gameWordEl.textContent = question.term;
                correctAnswer = question.definition; 
                options.push(correctAnswer);
                distractorsPool = vocabulary.filter(v => v.definition !== correctAnswer && v.type === question.type);
            }

            shuffleArray(distractorsPool);

            for (let i = 0; options.length < NUM_OPTIONS && i < distractorsPool.length; i++) {
                const distractorValue = (currentGameType === 'sentence-fill') ? distractorsPool[i].term : distractorsPool[i].definition;
                if (!options.includes(distractorValue)) {
                    options.push(distractorValue);
                }
            }
            while (options.length < NUM_OPTIONS) { 
                const emergencyOptionBase = (currentGameType === 'sentence-fill') ? "ÂÖ∂‰ªñË©ûË™û" : "ÂÖ∂‰ªñËß£Èáã";
                const emergencyOption = `${emergencyOptionBase} ${options.length + Math.floor(Math.random()*100)}`;
                if(!options.includes(emergencyOption)) options.push(emergencyOption);
                else options.push(`${emergencyOptionBase} ${options.length + Math.floor(Math.random()*1000)}`) 
            }

            shuffleArray(options);
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            document.getElementById('feedback-message').textContent = '';

            options.forEach(optionText => {
                const button = document.createElement('button');
                button.classList.add('btn', 'option-btn');
                button.textContent = optionText;
                button.onclick = () => checkAnswer(optionText === correctAnswer, button);
                optionsContainer.appendChild(button);
            });
        }

        function checkAnswer(isCorrect, buttonElement) {
            const feedbackMessage = document.getElementById('feedback-message');
            document.querySelectorAll('#options-container button').forEach(btn => btn.disabled = true);
            const question = gameQuestions[currentQuestionIndex];

            if (isCorrect) {
                score++;
                document.getElementById('score').textContent = score;
                buttonElement.classList.add('correct', 'animate-pulse');
                feedbackMessage.textContent = 'Á≠îÂ∞ç‰∫ÜÔºÅüéâ Â§™Ê£í‰∫ÜÔºÅ';
                feedbackMessage.className = 'feedback-message text-center text-green-500';
                correctSound();
            } else {
                buttonElement.classList.add('incorrect');
                feedbackMessage.textContent = 'Â∑ÆÂ∞ëÂ∞ëÂíãÔºÅÂÜçÊé•ÂÜçÂé≤ÔºÅüí™';
                feedbackMessage.className = 'feedback-message text-center text-orange-500';
                incorrectSound();
                const correctAnswerText = (currentGameType === 'sentence-fill') ? question.term : question.definition;
                document.querySelectorAll('#options-container button').forEach(btn => {
                    if (btn.textContent === correctAnswerText) {
                        btn.classList.add('correct'); 
                    }
                });
            }

            currentQuestionIndex++;
            setTimeout(() => {
                if (currentQuestionIndex < gameQuestions.length) {
                    loadGameQuestion();
                } else {
                    endGame();
                }
            }, 2000); 
        }

        function endGame() {
            updateGameProgressBar();
            const gameQuestionArea = document.getElementById('game-question-area');
            const optionsContainer = document.getElementById('options-container');
            const feedbackMessage = document.getElementById('feedback-message');
            const totalQuestionsForMode = gameQuestions.length || (currentGameType === 'sentence-fill' ? NUM_QUIZ_QUESTIONS : NUM_MEANING_MATCH_QUESTIONS);


            gameQuestionArea.innerHTML = `<p class="text-center text-2xl font-bold text-indigo-600">ÈÅäÊà≤ÁµêÊùüÔºÅ</p>`;
            optionsContainer.innerHTML = `<p class="text-center text-2xl font-bold">‰Ω†ÁöÑÁ∏ΩÂàÜÊòØÔºö ${score} / ${totalQuestionsForMode}</p>`;
            
            let endMsg = '';
            let endMsgClass = 'text-indigo-600';
            if (totalQuestionsForMode > 0 && score === totalQuestionsForMode) {
                endMsg = 'üéâ Âò©ÔºÅÂÖ®ÈÉ®Á≠îÂ∞çÔºÅ‰Ω†ÊòØË©ûÂΩôÂ§ßÂ∏´ÔºÅ ü•≥';
                endMsgClass = 'text-yellow-500';
            } else if (totalQuestionsForMode > 0 && score >= totalQuestionsForMode * 0.7) {
                endMsg = 'üëç ÂÅöÂæóÈùûÂ∏∏Âá∫Ëâ≤ÔºÅÁπºÁ∫åÂä™ÂäõÔºÅ ‚ú®';
                endMsgClass = 'text-green-500';
            } else if (totalQuestionsForMode > 0 && score >= totalQuestionsForMode / 2) {
                endMsg = 'ÂÅöÂæó‰∏çÈåØÔºÅ‰∏ãÊ¨°ÊúÉÊõ¥Â•ΩÔºÅüòä';
                endMsgClass = 'text-blue-500';
            } else {
                endMsg = 'ÔøΩ Âä†Ê≤πÔºÅÂ§öÂ§öÊ∫´ÁøíÔºå‰∏ãÊ¨°‰∏ÄÂÆöÈÄ≤Ê≠•ÔºÅ';
                endMsgClass = 'text-orange-500';
            }
            feedbackMessage.textContent = endMsg;
            feedbackMessage.className = `feedback-message text-center ${endMsgClass}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM ÂÆåÂÖ®ËºâÂÖ•‰∏¶Ëß£ÊûêÂÆåÁï¢ (DOM fully loaded and parsed.)");
            handleShowScreen('home-screen'); 
            shuffleCards();

            async function initAudio() {
                try {
                    if (typeof Tone !== 'undefined' && Tone.context.state !== 'running') {
                        await Tone.start();
                        console.log("Èü≥Ë®äÂ∑≤Ê∫ñÂÇôÂ•Ω (Audio context started via DOMContentLoaded interaction)");
                    } else if (typeof Tone !== 'undefined' && Tone.context.state === 'running') {
                         console.log("Èü≥Ë®äÂ∑≤Âú®ÈÅãË°å‰∏≠ (Audio context already running)");
                    }
                } catch (e) {
                    console.error("ÁÑ°Ê≥ïÂïüÂãïÈü≥Ë®ä (Error starting audio context):", e);
                }
            }
            ['click', 'touchstart'].forEach(eventName => {
                document.body.addEventListener(eventName, initAudio, { once: true });
            });
        });

    </script>
</body>
</html>
ÔøΩ
