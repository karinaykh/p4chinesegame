<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å››ä¸­æ–‡è©å½™æ¨‚åœ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            color: #1f2937; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden; 
        }
        .app-container {
            background-color: rgba(255, 255, 255, 0.95); 
            border-radius: 24px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 100%;
            max-width: 500px; 
            margin: 20px;
            overflow-y: auto; 
            max-height: 95vh;
        }

        .card-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
            min-height: 240px; 
        }
        .card {
            width: 300px;  
            height: 200px; 
            perspective: 1200px;
            cursor: pointer;
            margin-left: auto; 
            margin-right: auto;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
            transform-style: preserve-3d;
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            border-radius: 16px; 
        }
        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 15px; 
            border-radius: 16px;
            font-weight: 700; 
            text-align: center; 
            word-break: normal; 
            overflow-wrap: break-word; 
        }
        .card-front {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%); 
            color: white;
            font-size: 1.7rem; 
        }
        .card-back {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%); 
            color: white;
            transform: rotateY(180deg);
            font-size: 0.9rem; 
            overflow-y: auto; 
            justify-content: center; 
            align-items: center; 
            padding: 20px; 
        }
        .card-back-definition {
            margin-bottom: 10px;
            font-weight: 600;
            text-align: center; 
            width: 100%; 
        }
        .card-back-example {
            font-style: italic;
            font-size: 0.85rem;
            text-align: center; 
            width: 100%; 
        }


        .btn {
            padding: 12px 24px;
            border-radius: 12px; 
            font-weight: 700; 
            cursor: pointer;
            transition: all 0.3s ease; 
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn:hover {
            transform: translateY(-2px) scale(1.03); 
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .btn:active {
            transform: translateY(0px) scale(1); 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #facc15 0%, #eab308 100%); 
            color: #422006; 
        }
        .btn-secondary {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%); 
            color: white;
        }
        .btn-game {
            background: linear-gradient(135deg, #f472b6 0%, #ec4899 100%); 
            color: white;
        }
        .btn-nav { 
            background-color: #cbd5e1; 
            color: #1f2937;
        }
        .btn-nav:hover {
            background-color: #94a3b8;
            color: white;
        }

        .option-btn {
            background-color: #ffffff;
            color: #374151;
            border: 2px solid #e5e7eb; 
            width: 100%;
            text-align: center; /* Center text for vocabulary options */
            margin-bottom: 10px; 
            font-size: 1rem;
            padding: 15px; 
        }
        .option-btn:hover {
            background-color: #f0f9ff; 
            border-color: #60a5fa;
        }
        .option-btn.correct {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            color: white;
            border-color: #059669;
        }
        .option-btn.incorrect {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
            color: white;
            border-color: #dc2626;
        }
        .screen {
            display: none;
            width: 100%;
        }
        .active-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; 
            padding-top: 20px;
            min-height: calc(95vh - 40px); 
        }
        .progress-bar-container {
            width: 90%;
            max-width: 400px;
            height: 25px; 
            background-color: #e5e7eb;
            border-radius: 12px;
            margin: 15px auto;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #60a5fa 0%, #3b82f6 100%);
            border-radius: 12px;
            transition: width 0.4s ease-in-out;
        }
        .mascot-emoji-container { 
            width: 100px;
            height: 100px;
            margin-bottom: 15px;
            animation: bounce 2s infinite ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #FFD700; 
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .mascot-emoji { 
            font-size: 60px; 
            line-height: 1;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .title-text {
            font-size: 2.5rem; 
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
            background: -webkit-linear-gradient(#3b82f6, #8b5cf6); 
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .game-card {
            background-color: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
        }
        .quiz-sentence { /* Style for the sentence in quiz mode */
            font-size: 1.25rem;
            line-height: 1.8;
            margin-bottom: 20px;
            text-align: center;
            color: #374151;
        }
        .feedback-message {
            font-size: 1.1rem;
            height: 30px; 
            margin-top: 15px;
            font-weight: 600;
        }
        .icon { 
            font-size: 1.2em;
            display: inline-block; 
        }
        .flashcard-nav-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 400px; 
            margin: 20px auto;
        }
        .home-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px; 
            width: 100%;
        }
        .home-buttons .btn {
            width: 80%;
            max-width: 300px; 
            font-size: 1.25rem; 
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div id="home-screen" class="screen active-screen p-4 text-center">
            <div class="mascot-emoji-container">
                <span class="mascot-emoji">ğŸ’¡</span>
            </div>
            <h1 class="title-text">å°å››ä¸­æ–‡è©å½™æ¨‚åœ’</h1>
            <div class="home-buttons">
                <button onclick="handleShowScreen('flashcard-screen')" class="btn btn-primary"><span class="icon">ğŸƒ</span>æº«ç¿’è©å½™å¡</button>
                <button onclick="handleShowScreen('game-selection-screen')" class="btn btn-game"><span class="icon">ğŸ®</span>é–‹å§‹è©å½™éŠæˆ²</button>
            </div>
            <p class="mt-10 text-sm text-gray-500">å’Œå­—è©å°éˆç²¾ä¸€èµ·è¼•é¬†å­¸ä¸­æ–‡ï¼</p>
        </div>

        <div id="game-selection-screen" class="screen p-4 text-center">
            <h2 class="title-text text-purple-600 mb-8">é¸æ“‡éŠæˆ²æ¨¡å¼</h2>
            <div class="space-y-5 w-full max-w-sm">
                <button onclick="startGame('meaning-match')" class="btn btn-secondary text-lg w-full"><span class="icon">ğŸ§ </span>è©ç¾©é…å°æ¨‚</button>
                <button onclick="startGame('idiom-match')" class="btn btn-secondary text-lg w-full"><span class="icon">ğŸ“–</span>æˆèªæŒ‘æˆ°</button>
                <button onclick="startGame('sentence-fill')" class="btn btn-secondary text-lg w-full"><span class="icon">ğŸ“</span>å¥å­å¡«å……æ¨‚</button> 
            </div>
            <button onclick="handleShowScreen('home-screen')" class="btn btn-primary mt-12"><span class="icon">ğŸ </span>è¿”å›ä¸»é </button>
        </div>

        <div id="flashcard-screen" class="screen p-4">
            <h2 class="title-text text-blue-600 mb-2 text-center">æº«ç¿’è©å½™å¡</h2>
            <div class="card-container">
                <div class="card" onclick="flipCard()"> 
                    <div class="card-inner">
                        <div id="flashcard-front" class="card-front">
                            è©èª
                        </div>
                        <div id="flashcard-back" class="card-back">
                            <div id="flashcard-back-definition" class="card-back-definition">è§£é‡‹</div>
                            <div id="flashcard-back-example" class="card-back-example">ä¾‹å¥</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mb-3 text-gray-600 font-medium">
                <span id="card-counter"></span>
            </div>
            <div class="flashcard-nav-buttons">
                <button onclick="prevCard()" class="btn btn-nav"><span class="icon">â¬…ï¸</span>ä¸Šä¸€å¼µ</button>
                <button onclick="shuffleCards()" class="btn btn-nav"><span class="icon">ğŸ”€</span>éš¨æ©Ÿ</button>
                <button onclick="nextCard()" class="btn btn-nav">ä¸‹ä¸€å¼µ<span class="icon">â¡ï¸</span></button>
            </div>
            <div class="text-center mt-6"> 
                <button onclick="handleShowScreen('home-screen')" class="btn btn-primary"><span class="icon">ğŸ </span>è¿”å›ä¸»é </button>
            </div>
        </div>

        <div id="game-screen" class="screen p-4">
            <h2 id="game-title" class="title-text text-green-600 mb-1 text-center">éŠæˆ²æ¨¡å¼</h2>
            <div class="text-center mb-1 text-lg font-semibold">
                åˆ†æ•¸ï¼š<span id="score" class="text-yellow-500">0</span>
            </div>
            <div class="progress-bar-container">
                <div id="game-progress-bar" class="progress-bar"></div>
            </div>
            <div class="game-card mx-auto">
                <p class="text-center text-gray-600 mb-2">é¡Œç›®ï¼š<span id="question-counter">1</span> / <span id="total-questions">5</span></p> 
                <div id="game-question-area" class="text-center mb-6">
                    <div id="game-word" class="text-3xl font-bold text-indigo-700 break-all" style="display:none;">è©èª</div>
                     <div id="quiz-sentence-display" class="quiz-sentence" style="display:none;">å¥å­ ___ å¡«å……ã€‚</div>
                </div>
                <div id="options-container" class="space-y-2">
                </div>
            </div>
            <div id="feedback-message" class="feedback-message text-center"></div>
            <div class="text-center mt-6"> 
                <button onclick="handleShowScreen('game-selection-screen')" class="btn btn-primary"><span class="icon">ğŸ”„</span>è¿”å›éŠæˆ²é¸æ“‡</button>
            </div>
        </div>
    </div>

    <script>
        const synth = new Tone.Synth({
            oscillator: { type: "sine" },
            envelope: { attack: 0.01, decay: 0.1, sustain: 0.3, release: 0.5 }
        }).toDestination();

        const playSound = (note, duration = "16n", timeOffset = 0) => {
            if (typeof Tone !== 'undefined' && Tone.Transport.state !== 'started') {
                Tone.Transport.start();
            }
            synth.triggerAttackRelease(note, duration, Tone.now() + timeOffset);
        };

        const correctSound = () => { playSound("E5", "8n"); playSound("G5", "8n", 0.1); playSound("C6", "8n", 0.2); };
        const incorrectSound = () => playSound("C3", "4n");
        const flipSound = () => playSound("A4", "16n", 0.02);
        // Modified buttonClickSound to add a small offset
        const buttonClickSound = () => playSound("C4", "16n", 0.01); 

        document.body.addEventListener('click', function(event) {
            if (event.target.tagName === 'BUTTON') {
                const cardElement = event.target.closest('.card');
                if (cardElement && cardElement.onclick && cardElement.onclick.toString().includes('flipCard')) {
                    // Handled by flipCard
                } else if (event.target.onclick && event.target.onclick.toString().includes('flipCard')) {
                    // Handled by flipCard
                }
                else {
                    buttonClickSound();
                }
            }
        });

        const vocabulary = [
            // ... (Existing vocabulary with 'example', 'type', and 'quizSentence')
            { term: "åŸºç¤", definition: "äº‹ç‰©ç™¼å±•çš„èµ·å§‹é»æˆ–é‡è¦éƒ¨åˆ†ã€‚", example: "å­¸ç¿’ä»»ä½•çŸ¥è­˜éƒ½è¦æ‰“å¥½åŸºç¤ã€‚", quizSentence: "å­¸ç¿’æ–°çŸ¥è­˜ï¼Œé¦–å…ˆè¦æ‰“å¥½ ___ã€‚", type: "word" },
            { term: "è€ƒæ…®", definition: "èªçœŸæ€è€ƒï¼Œä»¥ä¾¿åšå‡ºæ±ºå®šæˆ–è™•ç†äº‹æƒ…ã€‚", example: "åšäº‹å‰è¦ä»”ç´°è€ƒæ…®å¾Œæœã€‚", quizSentence: "è³¼ç‰©å‰ï¼Œæˆ‘å€‘æ‡‰ ___ æ˜¯å¦çœŸçš„éœ€è¦ã€‚", type: "word" },
            { term: "è¨­æƒ³", definition: "æƒ³åƒã€æ§‹æƒ³ã€‚", example: "æˆ‘è¨­æƒ³å°‡ä¾†èƒ½æˆç‚ºä¸€åç§‘å­¸å®¶ã€‚", quizSentence: "ä½ èƒ½ ___ ä¸€ä¸‹æœªä¾†åŸå¸‚çš„é¢è²Œå—ï¼Ÿ", type: "word" },
            { term: "å°ˆåˆ©", definition: "ç™¼æ˜äººæˆ–è¨­è¨ˆäººå°å…¶ç™¼æ˜æˆ–è¨­è¨ˆä¾æ³•äº«æœ‰çš„å°ˆæœ‰æ¬Šåˆ©ã€‚", example: "é€™å€‹æ–°ç™¼æ˜å·²ç¶“ç”³è«‹äº†å°ˆåˆ©ã€‚", quizSentence: "ç‹ä¼¯ä¼¯çš„æ–°ç™¼æ˜æˆåŠŸç”³è«‹äº† ___ã€‚", type: "word" },
            { term: "å …æ¯…", definition: "æ„å¿—å …å®šï¼Œæœ‰æ¯…åŠ›ï¼Œä¸è¼•æ˜“æ”¾æ£„ã€‚", example: "ä»–æ†‘è‘—å …æ¯…çš„ç²¾ç¥å…‹æœäº†å›°é›£ã€‚", quizSentence: "é‹å‹•å“¡æ†‘è‘— ___ çš„ç²¾ç¥å®Œæˆäº†æ¯”è³½ã€‚", type: "word" },
            { term: "åˆ©ç›Š", definition: "å¥½è™•ã€‚", example: "æˆ‘å€‘ä¸æ‡‰ç‚ºå€‹äººåˆ©ç›Šæå®³é›†é«”ã€‚", quizSentence: "é€™é …è¨ˆåŠƒèƒ½ç‚ºç¤¾å€å¸¶ä¾†å¾ˆå¤š ___ã€‚", type: "word" },
            { term: "å‚³é€", definition: "æŠŠç‰©å“ã€æ¶ˆæ¯ç­‰å¾ä¸€è™•é€åˆ°å¦ä¸€è™•ã€‚", example: "éƒµå·®æ¯å¤©å‚³é€ä¿¡ä»¶ã€‚", quizSentence: "é´¿å­åœ¨å¤ä»£è¢«ç”¨ä¾† ___ ä¿¡æ¯ã€‚", type: "word" },
            { term: "è¨Šæ¯", definition: "æ¶ˆæ¯ã€è³‡è¨Šã€‚", example: "æˆ‘æ”¶åˆ°äº†æœ‹å‹ç™¼ä¾†çš„è¨Šæ¯ã€‚", quizSentence: "æ‰‹æ©Ÿå¯ä»¥å¿«é€Ÿæ¥æ”¶å„ç¨® ___ã€‚", type: "word" },
            { term: "æ‡‰ç”¨", definition: "ä½¿ç”¨ï¼ˆç†è«–ã€çŸ¥è­˜ã€æ–¹æ³•ç­‰ï¼‰ã€‚", example: "æˆ‘å€‘è¦å­¸æœƒæŠŠçŸ¥è­˜æ‡‰ç”¨åˆ°ç”Ÿæ´»ä¸­ã€‚", quizSentence: "é›»è…¦åœ¨å„è¡Œå„æ¥­éƒ½æœ‰å»£æ³›çš„ ___ã€‚", type: "word" },
            { term: "æ¸…æ¾ˆ", definition: "å½¢å®¹æ°´éå¸¸ä¹¾æ·¨é€æ˜ã€‚", example: "å°æ²³çš„æ°´æ¸…æ¾ˆè¦‹åº•ã€‚", quizSentence: "æ¹–æ°´ ___ï¼Œå¯ä»¥çœ‹åˆ°æ°´åº•çš„çŸ³é ­ã€‚", type: "word" },
            { term: "ç§‘æŠ€", definition: "ç§‘å­¸æŠ€è¡“ã€‚", example: "ç¾ä»£ç§‘æŠ€ç™¼å±•è¿…é€Ÿã€‚", quizSentence: "___ çš„é€²æ­¥æ”¹å–„äº†æˆ‘å€‘çš„ç”Ÿæ´»ã€‚", type: "word" },
            { term: "å¼•èª˜", definition: "ç”¨æŸç¨®æ‰‹æ®µæˆ–æ–¹æ³•ä¾†å¸å¼•æˆ–èª˜ä½¿åˆ¥äººã€‚", example: "ä¸è¦è¢«å£äººçš„èŠ±è¨€å·§èªæ‰€å¼•èª˜ã€‚", quizSentence: "ç‹ç‹¸ç”¨ç¾é£Ÿ ___ å°ç™½å…”ã€‚", type: "word" },
            { term: "åè¦†", definition: "ä¸€æ¬¡åˆä¸€æ¬¡ï¼›é‡è¤‡ã€‚", example: "ä»–åè¦†ç·´ç¿’é€™å€‹å‹•ä½œã€‚", quizSentence: "è€å¸« ___ å¼·èª¿è¦æ³¨æ„å®‰å…¨ã€‚", type: "word" },
            { term: "è‡‰è…«é¡é’", definition: "å½¢å®¹è‡‰éƒ¨å—å‚·ï¼Œåˆç´…åˆè…«åˆç™¼é’çš„æ¨£å­ã€‚", example: "ä»–ä¸å°å¿ƒæ‘”å€’ï¼Œè·Œå¾—è‡‰è…«é¡é’ã€‚", quizSentence: "æ‰“æ¶å¾Œï¼Œä»–è¢«æ‰“å¾— ___ã€‚", type: "word" },
            { term: "å‘†æ¿", definition: "ä¸éˆæ´»ï¼Œç¼ºä¹ç”Ÿæ°£ã€‚", example: "é€™ç¯‡æ–‡ç« çš„èªè¨€æœ‰äº›å‘†æ¿ã€‚", quizSentence: "ä»–çš„è¡¨æƒ…ç¸½æ˜¯é‚£éº¼ ___ï¼Œå¾ˆå°‘ç¬‘ã€‚", type: "word" },
            { term: "åƒè™§", definition: "å—åˆ°æå¤±æˆ–ä¸å…¬å¹³çš„å¾…é‡ã€‚", example: "ä»–å› ç‚ºè²ªå°ä¾¿å®œè€Œåƒäº†å¤§è™§ã€‚", quizSentence: "èª å¯¦çš„äººç¸½æ˜¯ä¸æœƒ ___ã€‚", type: "word" },
            { term: "ææ–™", definition: "è£½ä½œæˆå“æ‰€éœ€è¦çš„æ±è¥¿ã€‚", example: "åšè›‹ç³•éœ€è¦æº–å‚™å¾ˆå¤šææ–™ã€‚", quizSentence: "å»ºç¯‰å·¥äººéœ€è¦è¶³å¤ çš„å»ºç¯‰ ___ã€‚", type: "word" },
            { term: "æ‘”", definition: "è·Œå€’ã€‚", example: "èµ°è·¯è¦å°å¿ƒï¼Œä¸è¦æ‘”å€’ã€‚", quizSentence: "ä»–ä¸å°å¿ƒ ___ äº†ä¸€è·¤ã€‚", type: "word" },
            { term: "æŒ«æŠ˜", definition: "åœ¨éç¨‹ä¸­é‡åˆ°çš„å›°é›£å’Œå¤±æ•—ã€‚", example: "é‡åˆ°æŒ«æŠ˜ä¸è¦è¼•æ˜“æ”¾æ£„ã€‚", quizSentence: "äººç”Ÿé›£å…æœƒé‡åˆ° ___ å’Œå›°é›£ã€‚", type: "word" },
            { term: "æ”¾æ£„", definition: "ä¸å†å …æŒæˆ–è¿½æ±‚ã€‚", example: "ä»–æ±ºå®šæ”¾æ£„é€™å€‹ä¸åˆ‡å¯¦éš›çš„è¨ˆåŠƒã€‚", quizSentence: "é›–ç„¶å¾ˆé›£ï¼Œä½†ä»–å¾æœªæƒ³é ___ã€‚", type: "word" },
            { term: "åš´æ ¼", definition: "éµå®ˆè¦å®šæˆ–æ¨™æº–ï¼Œä¸æ”¾é¬†ã€‚", example: "è€å¸«å°æˆ‘å€‘çš„è¦æ±‚å¾ˆåš´æ ¼ã€‚", quizSentence: "æ•™ç·´å°é‹å‹•å“¡çš„è¨“ç·´éå¸¸ ___ã€‚", type: "word" },
            { term: "æ¡å–", definition: "æ¡ç´å’Œå¯¦è¡Œï¼ˆæ–¹æ³•ã€æ”¿ç­–ç­‰ï¼‰ã€‚", example: "æ”¿åºœæ¡å–äº†æ–°çš„æªæ–½ä¾†æ”¹å–„äº¤é€šã€‚", quizSentence: "é¢å°å•é¡Œï¼Œæˆ‘å€‘è¦ ___ æœ‰æ•ˆçš„è§£æ±ºæ–¹æ³•ã€‚", type: "word" },
            { term: "å²å®³", definition: "è¡¨ç¤ºç¨‹åº¦æ·±æˆ–èƒ½åŠ›å¼·ã€‚", example: "é€™å€‹é¢±é¢¨çœŸå²å®³ï¼", quizSentence: "ä»–çš„è¨˜æ†¶åŠ›éå¸¸ ___ï¼Œéç›®ä¸å¿˜ã€‚", type: "word" },
            { term: "æˆå", definition: "è®Šå¾—æœ‰åæ°£ã€‚", example: "ä»–å¤¢æƒ³æœ‰ä¸€å¤©èƒ½æˆç‚ºæˆåç•«å®¶ã€‚", quizSentence: "é€™ä½æ­Œæ‰‹å› ä¸€é¦–æ­Œè€Œè¿…é€Ÿ ___ã€‚", type: "word" },
            { term: "è‰±è¾›", definition: "å›°é›£è¾›è‹¦ã€‚", example: "æˆåŠŸçš„èƒŒå¾Œå¾€å¾€ä»˜å‡ºå¾ˆå¤šè‰±è¾›ã€‚", quizSentence: "ä»–å€‘ç¶“æ­·äº†ç„¡æ•¸ ___ æ‰å–å¾—æˆåŠŸã€‚", type: "word" },
            { term: "åš´å²", definition: "æ…‹åº¦åš´è‚…ï¼Œä¸å¯¬å®¹ã€‚", example: "çˆ¸çˆ¸ç”¨åš´å²çš„èªæ°£æ‰¹è©•äº†ä»–ã€‚", quizSentence: "æ ¡é•·ç”¨ ___ çš„ç›®å…‰çœ‹è‘—çŠ¯éŒ¯çš„å­¸ç”Ÿã€‚", type: "word" },
            { term: "è¾œè² ", definition: "å°ä¸èµ·åˆ¥äººçš„æœŸæœ›æˆ–å¥½æ„ã€‚", example: "æˆ‘å€‘ä¸èƒ½è¾œè² è€å¸«çš„æœŸæœ›ã€‚", quizSentence: "æˆ‘ä¸€å®šåŠªåŠ›å­¸ç¿’ï¼Œä¸ ___ çˆ¶æ¯çš„æœŸæœ›ã€‚", type: "word" },
            { term: "æµ¸æ·«", definition: "æ¯”å–»é•·æ™‚é–“è™•æ–¼æŸç¨®ç’°å¢ƒæˆ–æ€æƒ³å½±éŸ¿ä¹‹ä¸‹ã€‚", example: "ä»–å¾å°æµ¸æ·«åœ¨éŸ³æ¨‚ä¸­ã€‚", quizSentence: "é€™ä½å­¸è€…åœ¨å¤å…¸æ–‡å­¸æ–¹é¢ ___ å¤šå¹´ã€‚", type: "word" },
            { term: "ç¨±è®š", definition: "ç”¨è¨€èªè¡¨é”å°äººæˆ–äº‹ç‰©çš„å–œæ„›ã€æ•¬ä½©ã€‚", example: "è€å¸«ç¨±è®šå°æ˜æ¨‚æ–¼åŠ©äººã€‚", quizSentence: "å¤§å®¶éƒ½ ___ ä»–å‹‡æ•¢çš„è¡Œç‚ºã€‚", type: "word" },
            { term: "ç¬¨æ‹™", definition: "å‹•ä½œä¸éˆæ´»ã€ä¸å·§å¦™ã€‚", example: "å°é´¨å­èµ°è·¯çš„æ¨£å­å¾ˆç¬¨æ‹™ã€‚", quizSentence: "ä»–å‰›å­¸è·³èˆï¼Œå‹•ä½œé‚„æœ‰äº› ___ã€‚", type: "word" },
            { term: "è¼•æ’«", definition: "ç”¨æ‰‹è¼•è¼•åœ°æ‘¸ã€‚", example: "åª½åª½è¼•æ’«è‘—å­©å­çš„é ­é«®ã€‚", quizSentence: "å¾®é¢¨ ___ è‘—æ¹–é¢ï¼Œæ³›èµ·é™£é™£æ¼£æ¼ªã€‚", type: "word" },
            { term: "å„ªå…ˆ", definition: "æŠŠé‡è¦çš„äº‹æƒ…å…ˆåšã€‚", example: "é‡åˆ°ç·Šæ€¥æƒ…æ³ï¼Œè¦å„ªå…ˆè™•ç†ã€‚", quizSentence: "åœ¨è³‡æºæœ‰é™çš„æƒ…æ³ä¸‹ï¼Œæˆ‘å€‘è¦ ___ è€ƒæ…®æœ€è¿«åˆ‡çš„éœ€æ±‚ã€‚", type: "word" },
            { term: "æ³¨è¦–", definition: "é›†ä¸­ç›®å…‰çœ‹ã€‚", example: "ä»–å°ˆå¿ƒæ³¨è¦–è‘—é»‘æ¿ã€‚", quizSentence: "å°è²“å¥½å¥‡åœ° ___ è‘—é£›èˆçš„è´è¶ã€‚", type: "word" },
            { term: "ä¸Ÿæ£„", definition: "æ‰”æ‰ä¸è¦çš„æ±è¥¿ã€‚", example: "ä¸è¦éš¨åœ°ä¸Ÿæ£„åƒåœ¾ã€‚", quizSentence: "æˆ‘å€‘æ‡‰è©²æŠŠå»¢èˆŠé›»æ± å›æ”¶ï¼Œè€Œä¸æ˜¯éš¨æ„ ___ã€‚", type: "word" },
            { term: "è¨ªå•", definition: "ç‚ºäº†äº†è§£æƒ…æ³è€Œé€²è¡Œçš„çœ‹æœ›å’Œè«‡è©±ã€‚", example: "è¨˜è€…è¨ªå•äº†é‚£ä½è¦‹ç¾©å‹‡ç‚ºçš„è‹±é›„ã€‚", quizSentence: "æ ¡é•·è¦ªè‡ª ___ äº†ç”Ÿç—…çš„åŒå­¸ã€‚", type: "word" },
            { term: "èª¤è§£", definition: "ç†è§£å¾—ä¸æ­£ç¢ºã€‚", example: "ä»–å€‘ä¹‹é–“ç”¢ç”Ÿäº†ä¸€äº›å°èª¤è§£ã€‚", quizSentence: "é€™å¯èƒ½åªæ˜¯ä¸€å ´ ___ï¼Œæˆ‘å€‘æ‡‰è©²å¥½å¥½æºé€šã€‚", type: "word" },
            { term: "èŠå¤©", definition: "è¼•é¬†åœ°è«‡è©±ã€‚", example: "æˆ‘å€‘å¸¸å¸¸åœ¨å…¬åœ’è£¡èŠå¤©ã€‚", quizSentence: "æ”¾å­¸å¾Œï¼ŒåŒå­¸å€‘å–œæ­¡èšåœ¨ä¸€èµ· ___ã€‚", type: "word" },
            { term: "ä¸€è¦‹é¾æƒ…", definition: "ç”·å¥³ä¹‹é–“ç¬¬ä¸€æ¬¡è¦‹é¢å°±ç”¢ç”Ÿäº†æ„›æƒ…ã€‚", example: "ç‹å­å°ç°å§‘å¨˜ä¸€è¦‹é¾æƒ…ã€‚", quizSentence: "æ•…äº‹è£¡çš„ç”·å¥³ä¸»è§’åœ¨èˆæœƒä¸Š ___ã€‚", type: "idiom" },
            { term: "è¨€ä¹‹é‘¿é‘¿", definition: "å½¢å®¹èªªè©±æœ‰ç¢ºå¯¦çš„æ ¹æ“šï¼Œéå¸¸è‚¯å®šã€‚", example: "ä»–è¨€ä¹‹é‘¿é‘¿åœ°èªªè‡ªå·±çœ‹è¦‹äº†UFOã€‚", quizSentence: "ä»– ___ åœ°ä¿è­‰é€™ä»¶äº‹æ˜¯çœŸçš„ã€‚", type: "idiom" },
            { term: "ä¿ƒè†è«‡å¿ƒ", definition: "å½¢å®¹é›™æ–¹é è¿‘åè‘—ï¼Œè¦ªå¯†åœ°äº¤è«‡å¿ƒè£¡è©±ã€‚", example: "ä»–å€‘å€†ç¶“å¸¸ä¿ƒè†è«‡å¿ƒï¼Œç„¡æ‰€ä¸è«‡ã€‚", quizSentence: "çˆºçˆºå–œæ­¡å’Œæˆ‘å€‘ ___ï¼Œè¬›éå»çš„æ•…äº‹ã€‚", type: "idiom" },
            { term: "ç‚ºéä½œæ­¹", definition: "åšå„ç¨®å£äº‹ã€‚", example: "é‚£äº›ç‚ºéä½œæ­¹çš„å£äººæœ€çµ‚æœƒå—åˆ°æ‡²ç½°ã€‚", quizSentence: "è­¦å¯ŸæˆåŠŸæŠ“ç²äº†ä¸€ç¾¤ ___ çš„åŒªå¾’ã€‚", type: "idiom" },
            { term: "å®³ç¾£ä¹‹é¦¬", definition: "æ¯”å–»å±å®³é›†é«”çš„äººã€‚", example: "æˆ‘å€‘è¦æŠŠéšŠä¼ä¸­çš„å®³ç¾£ä¹‹é¦¬æªå‡ºä¾†ã€‚", quizSentence: "æ¯å€‹åœ˜éšŠéƒ½æ‡‰è©²è­¦æƒ• ___ çš„å‡ºç¾ã€‚", type: "idiom" },
            { term: "æŒºèº«è€Œå‡º", definition: "å½¢å®¹å‹‡æ•¢ç«™å‡ºä¾†ï¼Œæ‰¿æ“”è²¬ä»»æˆ–è§£æ±ºå›°é›£ã€‚", example: "åœ¨å±æ€¥é—œé ­ï¼Œæ¶ˆé˜²å“¡ç¸½æ˜¯æŒºèº«è€Œå‡ºã€‚", quizSentence: "ç•¶å°ç‹—æ‰é€²æ°´è£¡ï¼Œä»–æ¯«ä¸çŒ¶è±«åœ° ___ æ•‘äº†å®ƒã€‚", type: "idiom" },
            { term: "æ¯æ¯ç›¸é—œ", definition: "å½¢å®¹é—œä¿‚éå¸¸å¯†åˆ‡ã€‚", example: "ç’°å¢ƒä¿è­·èˆ‡æˆ‘å€‘çš„ç”Ÿæ´»æ¯æ¯ç›¸é—œã€‚", quizSentence: "æˆ‘å€‘çš„å¥åº·èˆ‡é£²é£Ÿç¿’æ…£ ___ã€‚", type: "idiom" },
            { term: "åŸ‹é ­è‹¦å¹¹", definition: "å½¢å®¹å°ˆå¿ƒä¸€æ„åœ°åˆ»è‹¦å·¥ä½œã€‚", example: "ç§‘å­¸å®¶å€‘æ­£åŸ‹é ­è‹¦å¹¹ï¼Œé€²è¡Œé‡è¦çš„ç ”ç©¶ã€‚", quizSentence: "ç‚ºäº†å®Œæˆä»»å‹™ï¼Œä»– ___äº†å¥½å¹¾å¤©ã€‚", type: "idiom" },
            { term: "é–‰é–€é€ è»Š", definition: "æ¯”å–»è„«é›¢å¯¦éš›ï¼Œåªæ†‘ä¸»è§€è¾¦äº‹ï¼Œä¸èˆ‡äººäº¤æµã€‚", example: "å­¸ç¿’æ–°çŸ¥è­˜ä¸èƒ½é–‰é–€é€ è»Šï¼Œè¦å¤šå’Œåˆ¥äººè¨è«–ã€‚", quizSentence: "è¨­è¨ˆç”¢å“ä¸èƒ½ ___ï¼Œè¦äº†è§£å¸‚å ´éœ€æ±‚ã€‚", type: "idiom" },
            { term: "åƒå·®ä¸é½Š", definition: "å½¢å®¹é•·çŸ­ã€é«˜ä½ã€å¥½å£ç­‰ä¸ä¸€è‡´ï¼Œä¸æ•´é½Šã€‚", example: "é€™äº›æ¨¹æœ¨é•·å¾—åƒå·®ä¸é½Šã€‚", quizSentence: "åŒå­¸å€‘çš„æ›¸æ³•ä½œå“æ°´å¹³ ___ã€‚", type: "idiom" },
            { term: "é›ªä¸­é€ç‚­", definition: "æ¯”å–»åœ¨åˆ¥äººæ€¥éœ€çš„æ™‚å€™çµ¦äºˆå¹«åŠ©ã€‚", example: "åœ¨ä»–æœ€å›°é›£çš„æ™‚å€™ï¼Œæœ‹å‹çš„å¹«åŠ©çœŸæ˜¯é›ªä¸­é€ç‚­ã€‚", quizSentence: "å°æ–¼ç½å€äººæ°‘ä¾†èªªï¼Œæ¯ä¸€ä»½æåŠ©éƒ½æ˜¯ ___ã€‚", type: "idiom" },
            { term: "æœ›æ¢…æ­¢æ¸´", definition: "æ¯”å–»ç”¨ç©ºæƒ³ä¾†å®‰æ…°è‡ªå·±ã€‚", example: "æ²’æœ‰æ°´å–ï¼Œå£«å…µå€‘åªèƒ½é æœ›æ¢…æ­¢æ¸´ä¾†å …æŒã€‚", quizSentence: "çœ‹è‘—ç¾é£Ÿåœ–ç‰‡å»åƒä¸åˆ°ï¼ŒçœŸæ˜¯ ___ å•Šï¼", type: "idiom" }
        ];


        let currentCardIndex = 0;
        let shuffledVocab = [...vocabulary];

        function handleShowScreen(screenId) {
            console.log(`æº–å‚™å°èˆªè‡³ (Preparing to navigate to): ${screenId}`);
            showScreen(screenId);
        }

        function showScreen(screenId) {
            const screens = document.querySelectorAll('.screen');
            let foundScreen = false;
            screens.forEach(screen => {
                if (screen.id === screenId) {
                    screen.classList.add('active-screen');
                    foundScreen = true;
                } else {
                    screen.classList.remove('active-screen');
                }
            });

            if (!foundScreen) {
                console.error(`éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°IDç‚º "${screenId}" çš„ç•«é¢ã€‚ (Error: Screen with ID "${screenId}" not found.)`);
                if (screenId !== 'home-screen') { 
                    const homeScreenElement = document.getElementById('home-screen');
                    if (homeScreenElement) {
                         console.log("å˜—è©¦è¿”å›ä¸»é  (Attempting to fallback to home screen).");
                         homeScreenElement.classList.add('active-screen');
                    } else {
                        console.error("è‡´å‘½éŒ¯èª¤ï¼šä¸»é ç•«é¢ (home-screen) ä¹Ÿæ‰¾ä¸åˆ°ï¼(Fatal Error: Home screen also not found!)");
                    }
                }
                return;
            }
            
            console.log(`æˆåŠŸé¡¯ç¤ºç•«é¢ (Successfully displayed screen): ${screenId}`);

            if (screenId === 'flashcard-screen') {
                loadFlashcard();
            }
        }

        function loadFlashcard() {
            if (shuffledVocab.length === 0) {
                console.warn("è©å½™åº«ç‚ºç©ºï¼Œç„¡æ³•è¼‰å…¥è©å½™å¡ã€‚(Vocabulary is empty, cannot load flashcard.)");
                return;
            }
            const card = shuffledVocab[currentCardIndex];
            document.getElementById('flashcard-front').textContent = card.term; 
            document.getElementById('flashcard-back-definition').textContent = card.definition;
            document.getElementById('flashcard-back-example').textContent = `ä¾‹ï¼š${card.example || 'æš«ç„¡ä¾‹å¥'}`; 
            
            const cardElement = document.querySelector('#flashcard-screen .card');
            if (cardElement) {
                cardElement.classList.remove('flipped');
            }
            document.getElementById('card-counter').textContent = `ç¬¬ ${currentCardIndex + 1} / ${shuffledVocab.length} å¼µ`;
        }

        function flipCard() {
            const cardElement = document.querySelector('#flashcard-screen .card');
            if (cardElement) {
                cardElement.classList.toggle('flipped');
                flipSound();
            }
        }

        function nextCard() {
            if (shuffledVocab.length === 0) return;
            currentCardIndex = (currentCardIndex + 1) % shuffledVocab.length;
            loadFlashcard();
        }

        function prevCard() {
            if (shuffledVocab.length === 0) return;
            currentCardIndex = (currentCardIndex - 1 + shuffledVocab.length) % shuffledVocab.length;
            loadFlashcard();
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function shuffleCards() {
            shuffleArray(shuffledVocab);
            currentCardIndex = 0;
            loadFlashcard();
        }

        let currentGameType = 'word'; 
        let gameQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        const NUM_QUIZ_QUESTIONS = 5; 
        const NUM_MEANING_MATCH_QUESTIONS = 10;
        const NUM_OPTIONS = 3;

        function startGame(type) {
            currentGameType = type;
            let title = '';
            let questionSource = [];
            let numTotalQuestions = 0;

            const gameWordEl = document.getElementById('game-word');
            const quizSentenceEl = document.getElementById('quiz-sentence-display');
            gameWordEl.style.display = 'none'; 
            quizSentenceEl.style.display = 'none'; 


            if (type === 'meaning-match') {
                title = 'è©ç¾©é…å°æ¨‚';
                questionSource = vocabulary.filter(v => v.type === 'word');
                numTotalQuestions = NUM_MEANING_MATCH_QUESTIONS;
                gameWordEl.style.display = 'block';
            } else if (type === 'idiom-match') {
                title = 'æˆèªæŒ‘æˆ°';
                questionSource = vocabulary.filter(v => v.type === 'idiom');
                numTotalQuestions = NUM_MEANING_MATCH_QUESTIONS;
                 gameWordEl.style.display = 'block';
            } else if (type === 'sentence-fill') {
                title = 'å¥å­å¡«å……æ¨‚';
                questionSource = vocabulary.filter(v => v.quizSentence && v.quizSentence.includes("___"));
                numTotalQuestions = NUM_QUIZ_QUESTIONS;
                quizSentenceEl.style.display = 'block';
            }
            document.getElementById('game-title').textContent = title;
            
            const uniqueTerms = new Set(questionSource.map(item => item.term));
            if (uniqueTerms.size < NUM_OPTIONS && questionSource.length >= NUM_OPTIONS) {
                 console.warn("è©å½™é¸é …é‡è¤‡è¼ƒå¤šï¼Œé¸é …å¯èƒ½ä¸å¤ ç¨ç‰¹ã€‚");
            } else if (questionSource.length < NUM_OPTIONS && type !== 'sentence-fill') { 
                 alert(`æŠ±æ­‰ï¼Œ${currentGameType === 'word' ? 'è©èª' : 'æˆèª'}æ•¸é‡ä¸è¶³ä»¥é–‹å§‹éŠæˆ² (æœ€å°‘éœ€è¦${NUM_OPTIONS}å€‹ä¸åŒçš„è©å½™)ã€‚`);
                handleShowScreen('game-selection-screen');
                return;
            } else if (questionSource.length === 0 && type === 'sentence-fill') {
                alert(`æŠ±æ­‰ï¼Œæ²’æœ‰è¶³å¤ çš„å¥å­å¡«å……é¡Œç›®ã€‚`);
                handleShowScreen('game-selection-screen');
                return;
            }


            shuffleArray(questionSource);
            gameQuestions = questionSource.slice(0, Math.min(numTotalQuestions, questionSource.length));
             if (gameQuestions.length === 0 && questionSource.length > 0) { 
                gameQuestions = [questionSource[0]];
            }
            
            currentQuestionIndex = 0;
            score = 0;
            document.getElementById('score').textContent = score;

            const totalQuestionsElement = document.getElementById('total-questions');
            totalQuestionsElement.textContent = gameQuestions.length || (type === 'sentence-fill' ? NUM_QUIZ_QUESTIONS : NUM_MEANING_MATCH_QUESTIONS);
            
            updateGameProgressBar();
            loadGameQuestion();
            handleShowScreen('game-screen');
        }
        
        function updateGameProgressBar() {
            const totalQ = gameQuestions.length || (currentGameType === 'sentence-fill' ? NUM_QUIZ_QUESTIONS : NUM_MEANING_MATCH_QUESTIONS);
            const progress = totalQ > 0 ? ((currentQuestionIndex) / totalQ) * 100 : 0;
            const progressBarElement = document.getElementById('game-progress-bar');
            if(progressBarElement) progressBarElement.style.width = `${progress}%`;
        }

        function loadGameQuestion() {
            if (currentQuestionIndex >= gameQuestions.length) {
                endGame();
                return;
            }
            updateGameProgressBar();
            document.getElementById('question-counter').textContent = currentQuestionIndex + 1;
            const question = gameQuestions[currentQuestionIndex];
            
            const gameWordEl = document.getElementById('game-word');
            const quizSentenceEl = document.getElementById('quiz-sentence-display');

            let correctAnswer;
            let options = [];
            let distractorsPool = [];

            if (currentGameType === 'sentence-fill') {
                gameWordEl.style.display = 'none';
                quizSentenceEl.style.display = 'block';
                quizSentenceEl.textContent = question.quizSentence;
                correctAnswer = question.term; 
                options.push(correctAnswer);
                distractorsPool = vocabulary.filter(v => v.term !== correctAnswer); 
            } else { 
                gameWordEl.style.display = 'block';
                quizSentenceEl.style.display = 'none';
                gameWordEl.textContent = question.term;
                correctAnswer = question.definition; 
                options.push(correctAnswer);
                distractorsPool = vocabulary.filter(v => v.definition !== correctAnswer && v.type === question.type);
            }

            shuffleArray(distractorsPool);

            for (let i = 0; options.length < NUM_OPTIONS && i < distractorsPool.length; i++) {
                const distractorValue = (currentGameType === 'sentence-fill') ? distractorsPool[i].term : distractorsPool[i].definition;
                if (!options.includes(distractorValue)) {
                    options.push(distractorValue);
                }
            }
            while (options.length < NUM_OPTIONS) { 
                const emergencyOptionBase = (currentGameType === 'sentence-fill') ? "å…¶ä»–è©èª" : "å…¶ä»–è§£é‡‹";
                const emergencyOption = `${emergencyOptionBase} ${options.length + Math.floor(Math.random()*100)}`;
                if(!options.includes(emergencyOption)) options.push(emergencyOption);
                else options.push(`${emergencyOptionBase} ${options.length + Math.floor(Math.random()*1000)}`) 
            }

            shuffleArray(options);
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            document.getElementById('feedback-message').textContent = '';

            options.forEach(optionText => {
                const button = document.createElement('button');
                button.classList.add('btn', 'option-btn');
                button.textContent = optionText;
                button.onclick = () => checkAnswer(optionText === correctAnswer, button);
                optionsContainer.appendChild(button);
            });
        }

        function checkAnswer(isCorrect, buttonElement) {
            const feedbackMessage = document.getElementById('feedback-message');
            document.querySelectorAll('#options-container button').forEach(btn => btn.disabled = true);
            const question = gameQuestions[currentQuestionIndex];

            if (isCorrect) {
                score++;
                document.getElementById('score').textContent = score;
                buttonElement.classList.add('correct', 'animate-pulse');
                feedbackMessage.textContent = 'ç­”å°äº†ï¼ğŸ‰ å¤ªæ£’äº†ï¼';
                feedbackMessage.className = 'feedback-message text-center text-green-500';
                correctSound();
            } else {
                buttonElement.classList.add('incorrect');
                feedbackMessage.textContent = 'å·®å°‘å°‘å’‹ï¼å†æ¥å†å²ï¼ğŸ’ª';
                feedbackMessage.className = 'feedback-message text-center text-orange-500';
                incorrectSound();
                const correctAnswerText = (currentGameType === 'sentence-fill') ? question.term : question.definition;
                document.querySelectorAll('#options-container button').forEach(btn => {
                    if (btn.textContent === correctAnswerText) {
                        btn.classList.add('correct'); 
                    }
                });
            }

            currentQuestionIndex++;
            setTimeout(() => {
                if (currentQuestionIndex < gameQuestions.length) {
                    loadGameQuestion();
                } else {
                    endGame();
                }
            }, 2000); 
        }

        function endGame() {
            updateGameProgressBar();
            const gameQuestionArea = document.getElementById('game-question-area');
            const optionsContainer = document.getElementById('options-container');
            const feedbackMessage = document.getElementById('feedback-message');
            const totalQuestionsForMode = gameQuestions.length || (currentGameType === 'sentence-fill' ? NUM_QUIZ_QUESTIONS : NUM_MEANING_MATCH_QUESTIONS);


            gameQuestionArea.innerHTML = `<p class="text-center text-2xl font-bold text-indigo-600">éŠæˆ²çµæŸï¼</p>`;
            optionsContainer.innerHTML = `<p class="text-center text-2xl font-bold">ä½ çš„ç¸½åˆ†æ˜¯ï¼š ${score} / ${totalQuestionsForMode}</p>`;
            
            let endMsg = '';
            let endMsgClass = 'text-indigo-600';
            if (totalQuestionsForMode > 0 && score === totalQuestionsForMode) {
                endMsg = 'ğŸ‰ å˜©ï¼å…¨éƒ¨ç­”å°ï¼ä½ æ˜¯è©å½™å¤§å¸«ï¼ ğŸ¥³';
                endMsgClass = 'text-yellow-500';
            } else if (totalQuestionsForMode > 0 && score >= totalQuestionsForMode * 0.7) {
                endMsg = 'ğŸ‘ åšå¾—éå¸¸å‡ºè‰²ï¼ç¹¼çºŒåŠªåŠ›ï¼ âœ¨';
                endMsgClass = 'text-green-500';
            } else if (totalQuestionsForMode > 0 && score >= totalQuestionsForMode / 2) {
                endMsg = 'åšå¾—ä¸éŒ¯ï¼ä¸‹æ¬¡æœƒæ›´å¥½ï¼ğŸ˜Š';
                endMsgClass = 'text-blue-500';
            } else {
                endMsg = 'ï¿½ åŠ æ²¹ï¼å¤šå¤šæº«ç¿’ï¼Œä¸‹æ¬¡ä¸€å®šé€²æ­¥ï¼';
                endMsgClass = 'text-orange-500';
            }
            feedbackMessage.textContent = endMsg;
            feedbackMessage.className = `feedback-message text-center ${endMsgClass}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM å®Œå…¨è¼‰å…¥ä¸¦è§£æå®Œç•¢ (DOM fully loaded and parsed.)");
            handleShowScreen('home-screen'); 
            shuffleCards();

            async function initAudio() {
                try {
                    if (typeof Tone !== 'undefined' && Tone.context.state !== 'running') {
                        await Tone.start();
                        console.log("éŸ³è¨Šå·²æº–å‚™å¥½ (Audio context started via DOMContentLoaded interaction)");
                    } else if (typeof Tone !== 'undefined' && Tone.context.state === 'running') {
                         console.log("éŸ³è¨Šå·²åœ¨é‹è¡Œä¸­ (Audio context already running)");
                    }
                } catch (e) {
                    console.error("ç„¡æ³•å•Ÿå‹•éŸ³è¨Š (Error starting audio context):", e);
                }
            }
            ['click', 'touchstart'].forEach(eventName => {
                document.body.addEventListener(eventName, initAudio, { once: true });
            });
        });

    </script>
</body>
</html>
ï¿½
